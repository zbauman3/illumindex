#include <memory.h>

#include "gfx/fonts.h"

const static uint32_t ascii8By12[] = {
    0x00000000, 0x00000000, 0x00000000, //
    0x00307878, 0x78303000, 0x30300000, // !
    0x00666666, 0x24000000, 0x00000000, // "
    0x006C6CFE, 0x6C6C6CFE, 0x6C6C0000, // #
    0x30307CC0, 0xC0780C0C, 0xF8303000, // $
    0x000000C4, 0xCC183060, 0xCC8C0000, // %
    0x0070D8D8, 0x70FADECC, 0xDC760000, // &
    0x00303030, 0x60000000, 0x00000000, // '
    0x000C1830, 0x60606030, 0x180C0000, // (
    0x00603018, 0x0C0C0C18, 0x30600000, // )
    0x00000066, 0x3CFF3C66, 0x00000000, // *
    0x00000018, 0x187E1818, 0x00000000, // +
    0x00000000, 0x00000000, 0x38386000, // ,
    0x00000000, 0x00FE0000, 0x00000000, // -
    0x00000000, 0x00000000, 0x38380000, // .
    0x00000206, 0x0C183060, 0xC0800000, // /
    0x007CC6D6, 0xD6D6D6D6, 0xC67C0000, // 0
    0x001030F0, 0x30303030, 0x30FC0000, // 1
    0x0078CCCC, 0x0C183060, 0xCCFC0000, // 2
    0x0078CC0C, 0x0C380C0C, 0xCC780000, // 3
    0x000C1C3C, 0x6CCCFE0C, 0x0C1E0000, // 4
    0x00FCC0C0, 0xC0F80C0C, 0xCC780000, // 5
    0x003860C0, 0xC0F8CCCC, 0xCC780000, // 6
    0x00FEC6C6, 0x060C1830, 0x30300000, // 7
    0x0078CCCC, 0xEC78DCCC, 0xCC780000, // 8
    0x0078CCCC, 0xCC7C1818, 0x30700000, // 9
    0x00000038, 0x38000038, 0x38000000, // :
    0x00000038, 0x38000038, 0x38183000, // ;
    0x000C1830, 0x60C06030, 0x180C0000, // <
    0x00000000, 0x7E007E00, 0x00000000, // =
    0x00603018, 0x0C060C18, 0x30600000, // >
    0x0078CC0C, 0x18303000, 0x30300000, // ?
    0x007CC6C6, 0xDEDEDEC0, 0xC07C0000, // @
    0x003078CC, 0xCCCCFCCC, 0xCCCC0000, // A
    0x00FC6666, 0x667C6666, 0x66FC0000, // B
    0x003C66C6, 0xC0C0C0C6, 0x663C0000, // C
    0x00F86C66, 0x66666666, 0x6CF80000, // D
    0x00FE6260, 0x647C6460, 0x62FE0000, // E
    0x00FE6662, 0x647C6460, 0x60F00000, // F
    0x003C66C6, 0xC0C0CEC6, 0x663E0000, // G
    0x00CCCCCC, 0xCCFCCCCC, 0xCCCC0000, // H
    0x00783030, 0x30303030, 0x30780000, // I
    0x001E0C0C, 0x0C0CCCCC, 0xCC780000, // J
    0x00E6666C, 0x6C786C6C, 0x66E60000, // K
    0x00F06060, 0x60606266, 0x66FE0000, // L
    0x00C6EEFE, 0xFED6C6C6, 0xC6C60000, // M
    0x00C6C6E6, 0xF6FEDECE, 0xC6C60000, // N
    0x00386CC6, 0xC6C6C6C6, 0x6C380000, // O
    0x00FC6666, 0x667C6060, 0x60F00000, // P
    0x00386CC6, 0xC6C6CEDE, 0x7C0C1E00, // Q
    0x00FC6666, 0x667C6C66, 0x66E60000, // R
    0x0078CCCC, 0xC07018CC, 0xCC780000, // S
    0x00FCB430, 0x30303030, 0x30780000, // T
    0x00CCCCCC, 0xCCCCCCCC, 0xCC780000, // U
    0x00CCCCCC, 0xCCCCCCCC, 0x78300000, // V
    0x00C6C6C6, 0xC6D6D66C, 0x6C6C0000, // W
    0x00CCCCCC, 0x783078CC, 0xCCCC0000, // X
    0x00CCCCCC, 0xCC783030, 0x30780000, // Y
    0x00FECE98, 0x18306062, 0xC6FE0000, // Z
    0x003C3030, 0x30303030, 0x303C0000, // [
    0x000080C0, 0x6030180C, 0x06020000, // backslash
    0x003C0C0C, 0x0C0C0C0C, 0x0C3C0000, // ]
    0x10386CC6, 0x00000000, 0x00000000, // ^
    0x00000000, 0x00000000, 0x0000FF00, // _
    0x30301800, 0x00000000, 0x00000000, // `
    0x00000000, 0x780C7CCC, 0xCC760000, // a
    0x00E06060, 0x7C666666, 0x66DC0000, // b
    0x00000000, 0x78CCC0C0, 0xCC780000, // c
    0x001C0C0C, 0x7CCCCCCC, 0xCC760000, // d
    0x00000000, 0x78CCFCC0, 0xCC780000, // e
    0x00386C60, 0x60F86060, 0x60F00000, // f
    0x00000000, 0x76CCCCCC, 0x7C0CCC78, // g
    0x00E06060, 0x6C766666, 0x66E60000, // h
    0x00181800, 0x78181818, 0x187E0000, // i
    0x000C0C00, 0x3C0C0C0C, 0x0CCCCC78, // j
    0x00E06060, 0x666C786C, 0x66E60000, // k
    0x00781818, 0x18181818, 0x187E0000, // l
    0x00000000, 0xFCD6D6D6, 0xD6C60000, // m
    0x00000000, 0xF8CCCCCC, 0xCCCC0000, // n
    0x00000000, 0x78CCCCCC, 0xCC780000, // o
    0x00000000, 0xDC666666, 0x667C60F0, // p
    0x00000000, 0x76CCCCCC, 0xCC7C0C1E, // q
    0x00000000, 0xEC6E7660, 0x60F00000, // r
    0x00000000, 0x78CC6018, 0xCC780000, // s
    0x00002060, 0xFC606060, 0x6C380000, // t
    0x00000000, 0xCCCCCCCC, 0xCC760000, // u
    0x00000000, 0xCCCCCCCC, 0x78300000, // v
    0x00000000, 0xC6C6D6D6, 0x6C6C0000, // w
    0x00000000, 0xC66C3838, 0x6CC60000, // x
    0x00000000, 0x66666666, 0x3C0C18F0, // y
    0x00000000, 0xFC8C1860, 0xC4FC0000, // z
    0x001C3030, 0x60C06030, 0x301C0000, // {
    0x00181818, 0x18001818, 0x18180000, // |
    0x00E03030, 0x180C1830, 0x30E00000, // }
    0x0073DACE, 0x00000000, 0x00000000, // ~
};

const static uint16_t ascii6By8[] = {
    0x0000, 0x0000, 0x0000, // Space
    0x10E3, 0x8410, 0x0100, // !
    0x6DB4, 0x8000, 0x0000, // "
    0x00A7, 0xCA29, 0xF280, // #
    0x20E4, 0x0C09, 0xC100, // $
    0x6590, 0x8421, 0x34C0, // %
    0x2145, 0x0855, 0x2340, // &
    0x30C2, 0x0000, 0x0000, // '
    0x1082, 0x0820, 0x8100, // (
    0x2041, 0x0410, 0x4200, // )
    0x00A3, 0x9F38, 0xA000, // *
    0x0041, 0x1F10, 0x4000, // +
    0x0000, 0x0000, 0xC308, // ,
    0x0000, 0x1F00, 0x0000, // -
    0x0000, 0x0000, 0xC300, // .
    0x0010, 0x8421, 0x0000, // /
    0x3914, 0xD565, 0x1380, // 0
    0x10C1, 0x0410, 0x4380, // 1
    0x3910, 0x4621, 0x07C0, // 2
    0x3910, 0x4E05, 0x1380, // 3
    0x0862, 0x927C, 0x2080, // 4
    0x7D04, 0x1E05, 0x1380, // 5
    0x1884, 0x1E45, 0x1380, // 6
    0x7C10, 0x8420, 0x8200, // 7
    0x3914, 0x4E45, 0x1380, // 8
    0x3914, 0x4F04, 0x2300, // 9
    0x0003, 0x0C00, 0xC300, // :
    0x0003, 0x0C00, 0xC308, // ;
    0x0842, 0x1020, 0x4080, // <
    0x0007, 0xC001, 0xF000, // =
    0x2040, 0x8108, 0x4200, // >
    0x3910, 0x4610, 0x0100, // ?
    0x3915, 0xD55D, 0x0380, // @
    0x3914, 0x517D, 0x1440, // A
    0x7914, 0x5E45, 0x1780, // B
    0x3914, 0x1041, 0x1380, // C
    0x7914, 0x5145, 0x1780, // D
    0x7D04, 0x1E41, 0x07C0, // E
    0x7D04, 0x1E41, 0x0400, // F
    0x3914, 0x1745, 0x13C0, // G
    0x4514, 0x5F45, 0x1440, // H
    0x3841, 0x0410, 0x4380, // I
    0x0410, 0x4145, 0x1380, // J
    0x4525, 0x1851, 0x2440, // K
    0x4104, 0x1041, 0x07C0, // L
    0x45B5, 0x5145, 0x1440, // M
    0x4595, 0x5345, 0x1440, // N
    0x3914, 0x5145, 0x1380, // O
    0x7914, 0x5E41, 0x0400, // P
    0x3914, 0x5155, 0x2340, // Q
    0x7914, 0x5E49, 0x1440, // R
    0x3914, 0x0E05, 0x1380, // S
    0x7C41, 0x0410, 0x4100, // T
    0x4514, 0x5145, 0x1380, // U
    0x4514, 0x5144, 0xA100, // V
    0x4515, 0x5555, 0x5280, // W
    0x4512, 0x8429, 0x1440, // X
    0x4514, 0x4A10, 0x4100, // Y
    0x7821, 0x0841, 0x0780, // Z
    0x3882, 0x0820, 0x8380, // [
    0x0102, 0x0408, 0x1000, // Back Slash
    0x3820, 0x8208, 0x2380, // ]
    0x10A4, 0x4000, 0x0000, // ^
    0x0000, 0x0000, 0x003F, // _
    0x30C1, 0x0000, 0x0000, // `
    0x0003, 0x813D, 0x13C0, // a
    0x4107, 0x9145, 0x1780, // b
    0x0003, 0x9141, 0x1380, // c
    0x0413, 0xD145, 0x13C0, // d
    0x0003, 0x9179, 0x0380, // e
    0x1882, 0x1E20, 0x8200, // f
    0x0003, 0xD144, 0xF04E, // g
    0x4107, 0x1249, 0x2480, // h
    0x1001, 0x0410, 0x4180, // i
    0x0801, 0x8208, 0x248C, // j
    0x4104, 0x9461, 0x4480, // k
    0x1041, 0x0410, 0x4180, // l
    0x0006, 0x9555, 0x1440, // m
    0x0007, 0x1249, 0x2480, // n
    0x0003, 0x9145, 0x1380, // o
    0x0007, 0x9145, 0x1790, // p
    0x0003, 0xD145, 0x13C1, // q
    0x0005, 0x8920, 0x8700, // r
    0x0003, 0x9038, 0x1380, // s
    0x0087, 0x8820, 0xA100, // t
    0x0004, 0x9249, 0x6280, // u
    0x0004, 0x5144, 0xA100, // v
    0x0004, 0x5155, 0xF280, // w
    0x0004, 0x9231, 0x2480, // x
    0x0004, 0x9248, 0xE118, // y
    0x0007, 0x8231, 0x0780, // z
    0x1882, 0x1820, 0x8180, // {
    0x1041, 0x0010, 0x4100, // |
    0x3020, 0x8308, 0x2300, // }
    0x2940, 0x0000, 0x0000, // ~
};

const static uint8_t ascii4By6[] = {
    0x00, 0x00, 0x00, // Space
    0x22, 0x20, 0x20, // !
    0x55, 0x00, 0x00, // "
    0x57, 0x57, 0x50, // #
    0x23, 0x63, 0x62, // $
    0x41, 0x24, 0x10, // %
    0x25, 0x35, 0x70, // &
    0x64, 0x00, 0x00, // '
    0x24, 0x44, 0x20, // (
    0x42, 0x22, 0x40, // )
    0x52, 0x72, 0x50, // *
    0x02, 0x72, 0x00, // +
    0x00, 0x00, 0x64, // ,
    0x00, 0x70, 0x00, // -
    0x00, 0x00, 0x20, // .
    0x11, 0x24, 0x40, // /
    0x35, 0x55, 0x60, // 0
    0x26, 0x22, 0x70, // 1
    0x61, 0x24, 0x70, // 2
    0x61, 0x21, 0x60, // 3
    0x15, 0x71, 0x10, // 4
    0x74, 0x61, 0x60, // 5
    0x24, 0x65, 0x20, // 6
    0x71, 0x32, 0x20, // 7
    0x25, 0x25, 0x20, // 8
    0x25, 0x31, 0x20, // 9
    0x00, 0x20, 0x20, // :
    0x00, 0x20, 0x64, // ;
    0x12, 0x42, 0x10, // <
    0x00, 0x70, 0x70, // =
    0x42, 0x12, 0x40, // >
    0x61, 0x20, 0x20, // ?
    0x75, 0x54, 0x70, // @
    0x25, 0x75, 0x50, // A
    0x65, 0x65, 0x60, // B
    0x34, 0x44, 0x30, // C
    0x65, 0x55, 0x60, // D
    0x74, 0x64, 0x70, // E
    0x74, 0x64, 0x40, // F
    0x34, 0x55, 0x30, // G
    0x55, 0x75, 0x50, // H
    0x72, 0x22, 0x70, // I
    0x11, 0x15, 0x20, // J
    0x55, 0x65, 0x50, // K
    0x44, 0x44, 0x70, // L
    0x57, 0x75, 0x50, // M
    0x57, 0x55, 0x50, // N
    0x25, 0x55, 0x20, // O
    0x65, 0x64, 0x40, // P
    0x25, 0x57, 0x30, // Q
    0x65, 0x65, 0x50, // R
    0x34, 0x71, 0x60, // S
    0x72, 0x22, 0x20, // T
    0x55, 0x55, 0x70, // U
    0x55, 0x55, 0x20, // V
    0x55, 0x77, 0x50, // W
    0x55, 0x25, 0x50, // X
    0x55, 0x22, 0x20, // Y
    0x71, 0x24, 0x70, // Z
    0x64, 0x44, 0x60, // [
    0x44, 0x21, 0x10, // Back Slash
    0x62, 0x22, 0x60, // ]
    0x25, 0x00, 0x00, // ^
    0x00, 0x00, 0x0F, // _
    0x62, 0x00, 0x00, // `
    0x00, 0x35, 0x70, // a
    0x44, 0x65, 0x60, // b
    0x00, 0x34, 0x30, // c
    0x11, 0x35, 0x30, // d
    0x00, 0x76, 0x30, // e
    0x12, 0x72, 0x20, // f
    0x00, 0x75, 0x17, // g
    0x44, 0x65, 0x50, // h
    0x20, 0x22, 0x20, // i
    0x20, 0x22, 0x26, // j
    0x44, 0x56, 0x50, // k
    0x22, 0x22, 0x20, // l
    0x00, 0x77, 0x50, // m
    0x00, 0x65, 0x50, // n
    0x00, 0x25, 0x20, // o
    0x00, 0x65, 0x64, // p
    0x00, 0x35, 0x31, // q
    0x00, 0x64, 0x40, // r
    0x00, 0x32, 0x60, // s
    0x02, 0x72, 0x30, // t
    0x00, 0x55, 0x70, // u
    0x00, 0x55, 0x20, // v
    0x00, 0x57, 0x70, // w
    0x00, 0x52, 0x50, // x
    0x00, 0x55, 0x24, // y
    0x00, 0x62, 0x30, // z
    0x32, 0x62, 0x30, // {
    0x22, 0x22, 0x20, // |
    0x62, 0x32, 0x60, // }
    0x5A, 0x00, 0x00, // ~
};

void fontInit(FontHandle *fontHandle, FontSize size) {
  FontHandle font = (FontHandle)malloc(sizeof(Font));
  fontSet(font, size);

  *fontHandle = font;
}

void fontEnd(FontHandle fontHandle) { free(fontHandle); }

uint32_t fontGetChunk(FontHandle font, uint16_t index) {
  switch (font->size) {
  case FONT_SIZE_SM:
    return (uint32_t)ascii4By6[index];
  case FONT_SIZE_MD:
    return (uint32_t)ascii6By8[index];
  case FONT_SIZE_LG:
    return (uint32_t)ascii8By12[index];
  default:
    return (uint32_t)0;
  }
}

void fontSet(FontHandle font, FontSize size) {
  font->size = size;
  switch (font->size) {
  case FONT_SIZE_SM:
    font->width = 4;
    font->height = 6;
    font->bitsPerChunk = 8;
    font->chunksPerChar = 3;
    break;
  case FONT_SIZE_LG:
    font->width = 8;
    font->height = 12;
    font->bitsPerChunk = 32;
    font->chunksPerChar = 3;
    break;
  case FONT_SIZE_MD:
  default:
    font->width = 6;
    font->height = 8;
    font->bitsPerChunk = 16;
    font->chunksPerChar = 3;
    break;
  }
}